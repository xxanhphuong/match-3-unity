<!DOCTYPE html>
<html lang="en-us">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Unity WebGL Player | Match 3</title>
        <link rel="stylesheet" href="./style.css">
        <script src="Build/UnityLoader.js"></script>
        <script>
            // Auto-load Unity game when page loads
            window.addEventListener('load', function() {
                UnityLoader.instantiate("unityContainer", "Build/docs.json", {
                    onProgress: function(gameInstance, progress) {
                        // Optional: You can add a loading progress bar here
                        console.log("Loading progress: " + (progress * 100) + "%");
                    },
                    Module: {
                        onRuntimeInitialized: function() {
                            console.log("Unity game loaded successfully!");
                        }
                    }
                });
            });

            // Override Unity's mobile warning
            window.addEventListener('DOMContentLoaded', function() {
                // Disable Unity's mobile detection warning
                if (typeof UnityLoader !== 'undefined') {
                    const originalInstantiate = UnityLoader.instantiate;
                    UnityLoader.instantiate = function(container, url, options) {
                        options = options || {};
                        options.Module = options.Module || {};
                        options.Module.print = function() {}; // Suppress console warnings
                        options.Module.printErr = function() {}; // Suppress console errors
                        return originalInstantiate.call(this, container, url, options);
                    };
                }
            });
        </script>
        <style>
            /* Hide any potential Unity warning dialogs */
            .unity-mobile-warning,
            .unity-warning,
            div[style*="position: fixed"][style*="z-index"] {
                display: none !important;
            }
            
            /* Optional: Add a simple loading indicator */
            #loadingIndicator {
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                font-family: Arial, sans-serif;
                font-size: 18px;
                color: #333;
                z-index: 1000;
            }
            
            .spinner {
                border: 4px solid #f3f3f3;
                border-top: 4px solid #3498db;
                border-radius: 50%;
                width: 40px;
                height: 40px;
                animation: spin 2s linear infinite;
                margin: 0 auto 10px;
            }
            
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
        </style>
    </head>
    <body style="display: none">
        <div id="unityContainer" style="width: 720px; height: 1280px; margin: auto">
            <!-- Optional loading indicator -->
            <div id="loadingIndicator">
                <div class="spinner"></div>
                Loading Game...
            </div>
        </div>
        
        <script>
            // Set height of body to match the inner height of window
            function setInnerHeight() {
                let vh = (window.innerHeight) * 0.01;
                document.documentElement.style.setProperty('--vh', `${vh}px`);
            }

            const screen = document.querySelector('#unityContainer');
            const footer = document.querySelector('footer');

            // Calculate the canvas size 
            function resizeCanvas() {
                const width = Number(screen.style.width.replace('px', ''));
                const height = Number(screen.style.height.replace('px', ''));
                const aspectRatio = height / width;
                screen.style.width = screen.style.height = '0px';
                setInnerHeight();
                
                let minDimensionScreen = Math.min(window.innerWidth, window.innerHeight);
                
                if(minDimensionScreen === window.innerHeight) {
                    minDimensionScreen *= .875;
                    
                    screen.style.width = `${ minDimensionScreen / aspectRatio }px`;
                    screen.style.height = `${ minDimensionScreen }px`;
                } else {
                    screen.style.width = `${ window.innerWidth }px`;
                    screen.style.height = `${ window.innerHeight }px`;
                }
            }

            resizeCanvas();
            window.addEventListener('resize', () => setTimeout(resizeCanvas, 1));
            
            // Convert jQuery to vanilla JavaScript
            setTimeout(function() {
                // Find and click button inside unityContainer (equivalent to $("#unityContainer").find("button").click())
                const unityContainer = document.getElementById('unityContainer');
                const button = unityContainer.querySelector('button');
                if (button) {
                    button.click();
                }
                
                // Fade in body (equivalent to $("body").fadeIn())
                const body = document.body;
                body.style.opacity = '0';
                body.style.display = 'block';
                body.style.transition = 'opacity 0.4s ease-in-out';
                
                // Trigger fade in
                setTimeout(() => {
                    body.style.opacity = '1';
                }, 10);
            }, 2000);
            
            // Hide loading indicator when Unity loads
            setTimeout(() => {
                const loadingIndicator = document.getElementById('loadingIndicator');
                if (loadingIndicator) {
                    loadingIndicator.style.display = 'none';
                }
            }, 5000); // Hide after 5 seconds as fallback
        </script>
    </body>
</html>